
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard Vendedora | ZonaPantys</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        :root{--primary-color:#e91e63;--secondary-color:#9c27b0;--dark-color:#1a1a1a;--light-color:#f8f9fa}
        *{margin:0;padding:0;box-sizing:border-box}
        body{font-family:'Segoe UI',Tahoma,Geneva,Verdana,sans-serif;background:var(--light-color)}
        .sidebar{position:fixed;left:0;top:0;height:100vh;width:260px;background:linear-gradient(135deg,var(--secondary-color),var(--primary-color));padding:2rem 0;z-index:1000;overflow-y:auto}
        .sidebar-header{padding:0 1.5rem 2rem;border-bottom:1px solid rgba(255,255,255,.2)}
        .sidebar-logo{color:white;font-size:1.5rem;font-weight:bold;text-decoration:none;display:flex;align-items:center;gap:.5rem}
        .sidebar-menu{padding:2rem 0}
        .menu-item{padding:.75rem 1.5rem;color:rgba(255,255,255,.8);display:flex;align-items:center;gap:1rem;cursor:pointer;transition:all .3s}
        .menu-item:hover,.menu-item.active{background:rgba(255,255,255,.1);color:white}
        .menu-item i{font-size:1.2rem;width:24px}
        .main-content{margin-left:260px;padding:2rem;min-height:100vh}
        .dashboard-header{background:white;padding:1.5rem 2rem;border-radius:15px;box-shadow:0 2px 10px rgba(0,0,0,.05);margin-bottom:2rem;display:flex;justify-content:space-between;align-items:center}
        .user-info{display:flex;align-items:center;gap:1rem}
        .user-avatar{width:50px;height:50px;border-radius:50%;background:linear-gradient(135deg,var(--secondary-color),var(--primary-color));display:flex;align-items:center;justify-content:center;color:white;font-size:1.5rem;font-weight:bold}
        .user-details h3{margin:0;font-size:1.1rem;color:var(--dark-color)}
        .user-details p{margin:0;font-size:.85rem;color:#666}
        .header-actions{display:flex;align-items:center;gap:1rem}
        .language-selector{position:relative}
        .language-btn{background:var(--light-color);color:var(--dark-color);border:1px solid #e0e0e0;padding:.5rem 1rem;border-radius:25px;cursor:pointer;font-weight:500;font-size:.85rem;transition:all .3s}
        .language-btn:hover{background:var(--secondary-color);color:white}
        .language-dropdown{display:none;position:absolute;top:100%;right:0;background:white;border-radius:10px;box-shadow:0 5px 25px rgba(0,0,0,.2);margin-top:.5rem;min-width:150px;z-index:1000}
        .language-dropdown.active{display:block}
        .language-option{padding:.75rem 1rem;cursor:pointer;color:#333}
        .language-option:hover{background:var(--light-color)}
        .btn-logout{background:var(--secondary-color);color:white;border:none;padding:.5rem 1.5rem;border-radius:25px;cursor:pointer}
        .btn-logout:hover{background:var(--primary-color)}
        .content-section{display:none}
        .content-section.active{display:block}
        .section-title{font-size:1.8rem;color:var(--dark-color);margin-bottom:1.5rem}
        .stats-container{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:1.5rem;margin-bottom:2rem}
        .stat-card{background:white;padding:1.5rem;border-radius:15px;box-shadow:0 2px 10px rgba(0,0,0,.05)}
        .stat-card-icon{width:50px;height:50px;border-radius:10px;display:flex;align-items:center;justify-content:center;font-size:1.5rem;margin-bottom:1rem}
        .stat-card-value{font-size:2rem;font-weight:bold;color:var(--dark-color)}
        .stat-card-label{color:#666;font-size:.9rem}
        .content-card{background:white;padding:2rem;border-radius:15px;box-shadow:0 2px 10px rgba(0,0,0,.05);margin-bottom:2rem}
        .upload-zone{border:2px dashed #ccc;border-radius:15px;padding:3rem;text-align:center;cursor:pointer;transition:all .3s;background:var(--light-color)}
        .upload-zone:hover{border-color:var(--primary-color);background:rgba(233,30,99,.05)}
        .upload-zone i{font-size:3rem;color:var(--primary-color);margin-bottom:1rem}
        .upload-zone h3{color:var(--dark-color);margin-bottom:.5rem}
        .upload-zone p{color:#666;font-size:.9rem}
        .file-input{display:none}
        .media-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(250px,1fr));gap:1.5rem;margin-top:2rem}
        .media-card{background:white;border-radius:15px;overflow:hidden;box-shadow:0 2px 10px rgba(0,0,0,.05);transition:all .3s}
        .media-card:hover{transform:translateY(-5px);box-shadow:0 5px 20px rgba(0,0,0,.1)}
        .media-preview{height:200px;width:100%;object-fit:cover;background:#f0f0f0}
        .media-info{padding:1rem}
        .media-title{font-weight:bold;color:var(--dark-color);margin-bottom:.5rem}
        .media-date{color:#666;font-size:.85rem}
        .media-actions{display:flex;gap:.5rem;margin-top:.5rem}
        .btn-delete{background:#f44336;color:white;border:none;padding:.5rem 1rem;border-radius:8px;cursor:pointer;font-size:.85rem}
        .btn-delete:hover{background:#d32f2f}
        .empty-state{text-align:center;padding:4rem 2rem;background:white;border-radius:15px;box-shadow:0 2px 10px rgba(0,0,0,.05)}
        .empty-state i{font-size:4rem;color:#ccc;margin-bottom:1rem}
        .empty-state h3{color:var(--dark-color);margin-bottom:.5rem}
        .empty-state p{color:#666}
        .loading{position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,.5);display:none;align-items:center;justify-content:center;z-index:9999}
        .loading.active{display:flex}
        .loading-spinner{background:white;padding:2rem;border-radius:15px;text-align:center}
        .loading-spinner i{font-size:3rem;color:var(--primary-color);animation:spin 1s linear infinite}
        @keyframes spin{0%{transform:rotate(0deg)}100%{transform:rotate(360deg)}}
        @media(max-width:768px){.sidebar{transform:translateX(-100%)}.main-content{margin-left:0;padding:1rem}.dashboard-header{flex-direction:column;gap:1rem}}
    </style>
</head>
<body>
    <div class="loading" id="loading">
        <div class="loading-spinner">
            <i class="fas fa-spinner fa-spin"></i>
            <p style="margin-top:1rem;color:var(--dark-color)" data-i18n="uploading">Subiendo...</p>
        </div>
    </div>
    
    <div class="sidebar">
        <div class="sidebar-header">
            <a href="index.html" class="sidebar-logo"><span>üî•</span><span>ZONAPANTYS</span></a>
        </div>
        <div class="sidebar-menu">
            <div class="menu-item active" onclick="showSection('resumen')"><i class="fas fa-chart-line"></i><span data-i18n="menu.overview">Resumen</span></div>
            <div class="menu-item" onclick="showSection('contenido')"><i class="fas fa-photo-video"></i><span data-i18n="menu.content">Mi Contenido</span></div>
            <div class="menu-item" onclick="showSection('perfil')"><i class="fas fa-user"></i><span data-i18n="menu.profile">Mi Perfil</span></div>
        </div>
    </div>

    <div class="main-content">
        <div class="dashboard-header">
            <div class="user-info">
                <div class="user-avatar" id="userAvatar">V</div>
                <div class="user-details">
                    <h3 id="userName" data-i18n="header.loading">Cargando...</h3>
                    <p id="userEmail">vendedora@email.com</p>
                </div>
            </div>
            <div class="header-actions">
                <div class="language-selector">
                    <button class="language-btn" id="languageBtn">üåê <span id="currentLang">ES</span></button>
                    <div class="language-dropdown" id="languageDropdown">
                        <div class="language-option" onclick="changeLanguage('es')">üá™üá∏ Espa√±ol</div>
                        <div class="language-option" onclick="changeLanguage('en')">üá∫üá∏ English</div>
                        <div class="language-option" onclick="changeLanguage('pt')">üáßüá∑ Portugu√™s</div>
                        <div class="language-option" onclick="changeLanguage('fr')">üá´üá∑ Fran√ßais</div>
                        <div class="language-option" onclick="changeLanguage('de')">üá©üá™ Deutsch</div>
                        <div class="language-option" onclick="changeLanguage('it')">üáÆüáπ Italiano</div>
                    </div>
                </div>
                <button class="btn-logout" onclick="logout()"><i class="fas fa-sign-out-alt"></i> <span data-i18n="header.logout">Cerrar Sesi√≥n</span></button>
            </div>
        </div>

        <div id="resumen" class="content-section active">
            <h2 class="section-title" data-i18n="overview.title">Resumen General</h2>
            <div class="stats-container">
                <div class="stat-card">
                    <div class="stat-card-icon" style="background:#fce4ec;color:#c2185b"><i class="fas fa-photo-video"></i></div>
                    <div class="stat-card-value" id="statMedia">0</div>
                    <div class="stat-card-label" data-i18n="overview.media">Contenido</div>
                </div>
                <div class="stat-card">
                    <div class="stat-card-icon" style="background:#e8f5e9;color:#388e3c"><i class="fas fa-dollar-sign"></i></div>
                    <div class="stat-card-value">$0</div>
                    <div class="stat-card-label" data-i18n="overview.earnings">Ganancias</div>
                </div>
            </div>
        </div>

        <div id="contenido" class="content-section">
            <h2 class="section-title" data-i18n="content.title">Mi Contenido</h2>
            <div class="content-card">
                <h3 style="margin-bottom:1.5rem"><i class="fas fa-images"></i> <span data-i18n="content.photos">Subir Fotos</span></h3>
                <input type="file" id="photoInput" class="file-input" accept="image/*" multiple>
                <div class="upload-zone" onclick="document.getElementById('photoInput').click()">
                    <i class="fas fa-images"></i>
                    <h3 data-i18n="content.uploadPhoto">Subir Fotos</h3>
                    <p data-i18n="content.uploadPhotoDesc">Click para seleccionar fotos</p>
                </div>
            </div>
            <div class="content-card">
                <h3 style="margin-bottom:1.5rem"><i class="fas fa-video"></i> <span data-i18n="content.videos">Subir Videos</span></h3>
                <input type="file" id="videoInput" class="file-input" accept="video/*">
                <div class="upload-zone" onclick="document.getElementById('videoInput').click()">
                    <i class="fas fa-video"></i>
                    <h3 data-i18n="content.uploadVideo">Subir Video</h3>
                    <p data-i18n="content.uploadVideoDesc">Click para seleccionar video</p>
                </div>
            </div>
            <h3 style="margin:2rem 0 1rem"><i class="fas fa-photo-video"></i> <span data-i18n="content.gallery">Galer√≠a</span></h3>
            <div class="media-grid" id="mediaGrid"></div>
        </div>

        <div id="perfil" class="content-section">
            <h2 class="section-title" data-i18n="profile.title">Mi Perfil</h2>
            <div class="content-card">
                <div style="display:flex;align-items:center;gap:2rem">
                    <div class="user-avatar" style="width:100px;height:100px;font-size:3rem" id="profileAvatar">V</div>
                    <div>
                        <h2 id="profileName">Nombre</h2>
                        <p id="profileEmail">email</p>
                        <p style="color:var(--primary-color);margin-top:.5rem"><i class="fas fa-check-circle"></i> <span data-i18n="profile.verified">Verificada</span></p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
    <script>
const t={es:{menu:{overview:"Resumen",content:"Mi Contenido",profile:"Mi Perfil"},header:{loading:"Cargando...",logout:"Cerrar Sesi√≥n"},uploading:"Subiendo...",overview:{title:"Resumen General",media:"Contenido",earnings:"Ganancias"},content:{title:"Mi Contenido",photos:"Subir Fotos",uploadPhoto:"Subir Fotos",uploadPhotoDesc:"Click para seleccionar fotos (JPG, PNG, WEBP)",videos:"Subir Videos",uploadVideo:"Subir Video",uploadVideoDesc:"Click para seleccionar video (MP4, MOV)",gallery:"Galer√≠a"},profile:{title:"Mi Perfil",verified:"Verificada"}},en:{menu:{overview:"Overview",content:"My Content",profile:"My Profile"},header:{loading:"Loading...",logout:"Logout"},uploading:"Uploading...",overview:{title:"Overview",media:"Content",earnings:"Earnings"},content:{title:"My Content",photos:"Upload Photos",uploadPhoto:"Upload Photos",uploadPhotoDesc:"Click to select photos (JPG, PNG, WEBP)",videos:"Upload Videos",uploadVideo:"Upload Video",uploadVideoDesc:"Click to select video (MP4, MOV)",gallery:"Gallery"},profile:{title:"My Profile",verified:"Verified"}},pt:{menu:{overview:"Resumo",content:"Meu Conte√∫do",profile:"Meu Perfil"},header:{loading:"Carregando...",logout:"Sair"},uploading:"Enviando...",overview:{title:"Resumo Geral",media:"Conte√∫do",earnings:"Ganhos"},content:{title:"Meu Conte√∫do",photos:"Enviar Fotos",uploadPhoto:"Enviar Fotos",uploadPhotoDesc:"Clique para selecionar fotos",videos:"Enviar V√≠deos",uploadVideo:"Enviar V√≠deo",uploadVideoDesc:"Clique para selecionar v√≠deo",gallery:"Galeria"},profile:{title:"Meu Perfil",verified:"Verificada"}},fr:{menu:{overview:"Aper√ßu",content:"Mon Contenu",profile:"Mon Profil"},header:{loading:"Chargement...",logout:"D√©connexion"},uploading:"T√©l√©chargement...",overview:{title:"Aper√ßu",media:"Contenu",earnings:"Revenus"},content:{title:"Mon Contenu",photos:"T√©l√©charger Photos",uploadPhoto:"T√©l√©charger Photos",uploadPhotoDesc:"Cliquez pour s√©lectionner",videos:"T√©l√©charger Vid√©os",uploadVideo:"T√©l√©charger Vid√©o",uploadVideoDesc:"Cliquez pour s√©lectionner",gallery:"Galerie"},profile:{title:"Mon Profil",verified:"V√©rifi√©e"}},de:{menu:{overview:"√úbersicht",content:"Mein Inhalt",profile:"Mein Profil"},header:{loading:"Laden...",logout:"Abmelden"},uploading:"Hochladen...",overview:{title:"√úbersicht",media:"Inhalt",earnings:"Einnahmen"},content:{title:"Mein Inhalt",photos:"Fotos Hochladen",uploadPhoto:"Fotos Hochladen",uploadPhotoDesc:"Klicken zum Ausw√§hlen",videos:"Videos Hochladen",uploadVideo:"Video Hochladen",uploadVideoDesc:"Klicken zum Ausw√§hlen",gallery:"Galerie"},profile:{title:"Mein Profil",verified:"Verifiziert"}},it:{menu:{overview:"Panoramica",content:"I Miei Contenuti",profile:"Il Mio Profilo"},header:{loading:"Caricamento...",logout:"Esci"},uploading:"Caricamento...",overview:{title:"Panoramica",media:"Contenuto",earnings:"Guadagni"},content:{title:"I Miei Contenuti",photos:"Carica Foto",uploadPhoto:"Carica Foto",uploadPhotoDesc:"Clicca per selezionare",videos:"Carica Video",uploadVideo:"Carica Video",uploadVideoDesc:"Clicca per selezionare",gallery:"Galleria"},profile:{title:"Il Mio Profilo",verified:"Verificata"}}};
let lang=localStorage.getItem('zonapantys_lang')||'es',sb,cu=null,cs=null;

function initSupabase(){
    if(typeof window.supabase!=='undefined'){
        sb=window.supabase.createClient('https://djycvnfdaugxmshbahzh.supabase.co','eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImRqeWN2bmZkYXVneG1zaGJiaHpoIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njg4Nzk3NDgsImV4cCI6MjA4NDQ1NTc0OH0.YZsqWlub2ek3zNmVv2ETzwR_ptDdoFhNZm1u9c1vghI',{auth:{persistSession:true,autoRefreshToken:true,storage:window.localStorage}});
        console.log('‚úÖ Supabase OK');
        checkAuth();
    }else setTimeout(initSupabase,100);
}
initSupabase();

async function checkAuth(){
    try{
        const{data:{session}}=await sb.auth.getSession();
        if(!session?.user){window.location.href='login.html';return}
        cu=session.user;
        await loadUserData(session.user.email);
        await loadStats();
        await loadMedia();
    }catch(e){window.location.href='login.html'}
}

async function loadUserData(e){
    try{
        const{data:s}=await sb.from('sellers').select('*').eq('email',e).single();
        if(s){
            cs=s;
            const n=s.stage_name||s.username,i=n.charAt(0).toUpperCase();
            document.getElementById('userName').textContent=n;
            document.getElementById('userEmail').textContent=s.email;
            document.getElementById('userAvatar').textContent=i;
            document.getElementById('profileName').textContent=n;
            document.getElementById('profileEmail').textContent=s.email;
            document.getElementById('profileAvatar').textContent=i;
            console.log('‚úÖ Seller:',s.seller_id);
        }
    }catch(err){console.error('Error:',err)}
}

async function loadStats(){
    try{
        const{data:m}=await sb.from('seller_media').select('*').eq('seller_id',cs.seller_id);
        document.getElementById('statMedia').textContent=m?.length||0;
    }catch(e){}
}

async function loadMedia(){
    try{
        const{data:m}=await sb.from('seller_media').select('*').eq('seller_id',cs.seller_id).order('created_at',{ascending:false});
        const g=document.getElementById('mediaGrid');
        if(!m||!m.length){g.innerHTML='<div class="empty-state"><i class="fas fa-photo-video"></i><h3>No hay contenido</h3><p>Sube tu primera foto o video</p></div>';return}
        g.innerHTML=m.map(i=>'<div class="media-card">'+(i.media_type==='photo'?'<img src="'+i.media_url+'" class="media-preview">':'<video src="'+i.media_url+'" class="media-preview" controls></video>')+'<div class="media-info"><div class="media-title">'+(i.title||'Media')+'</div><div class="media-date">'+new Date(i.created_at).toLocaleDateString()+'</div><div class="media-actions"><button class="btn-delete" onclick="deleteMedia('+i.media_id+',\''+i.media_url+'\')"><i class="fas fa-trash"></i> Eliminar</button></div></div></div>').join('');
    }catch(e){}
}

document.getElementById('photoInput').addEventListener('change',async(e)=>{
    if(!e.target.files.length||!cs)return;
    document.getElementById('loading').classList.add('active');
    for(let f of e.target.files){
        const fn=cs.seller_id+'_'+Date.now()+'.'+f.name.split('.').pop();
        const{error:ue}=await sb.storage.from('media').upload('photos/'+fn,f);
        if(!ue){
            const{data:u}=sb.storage.from('media').getPublicUrl('photos/'+fn);
            await sb.from('seller_media').insert({seller_id:cs.seller_id,media_type:'photo',media_url:u.publicUrl,title:f.name});
        }
    }
    document.getElementById('loading').classList.remove('active');
    e.target.value='';
    await loadStats();await loadMedia();
    alert('‚úÖ Fotos subidas');
});

document.getElementById('videoInput').addEventListener('change',async(e)=>{
    const f=e.target.files[0];
    if(!f||!cs)return;
    document.getElementById('loading').classList.add('active');
    const fn=cs.seller_id+'_'+Date.now()+'.'+f.name.split('.').pop();
    const{error:ue}=await sb.storage.from('media').upload('videos/'+fn,f);
    if(!ue){
        const{data:u}=sb.storage.from('media').getPublicUrl('videos/'+fn);
        await sb.from('seller_media').insert({seller_id:cs.seller_id,media_type:'video',media_url:u.publicUrl,title:f.name});
    }
    document.getElementById('loading').classList.remove('active');
    e.target.value='';
    await loadStats();await loadMedia();
    alert('‚úÖ Video subido');
});

async function deleteMedia(id,url){
    if(!confirm('¬øEliminar?'))return;
    await sb.storage.from('media').remove([url.split('/media/')[1]]);
    await sb.from('seller_media').delete().eq('media_id',id);
    await loadStats();await loadMedia();
    alert('‚úÖ Eliminado');
}

function changeLanguage(l){
    lang=l;
    localStorage.setItem('zonapantys_lang',l);
    updateContent();
    document.getElementById('currentLang').textContent=l.toUpperCase();
    document.getElementById('languageDropdown').classList.remove('active');
}

function updateContent(){
    const tr=t[lang];
    document.querySelectorAll('[data-i18n]').forEach(e=>{
        const k=e.getAttribute('data-i18n').split('.');
        let v=tr;
        for(let key of k)v=v[key];
        if(v)e.textContent=v;
    });
}

function showSection(id){
    document.querySelectorAll('.content-section').forEach(s=>s.classList.remove('active'));
    document.querySelectorAll('.menu-item').forEach(i=>i.classList.remove('active'));
    document.getElementById(id).classList.add('active');
    event.target.closest('.menu-item').classList.add('active');
}

async function logout(){
    await sb.auth.signOut();
    localStorage.clear();
    window.location.href='index.html';
}

document.getElementById('languageBtn').addEventListener('click',e=>{e.stopPropagation();document.getElementById('languageDropdown').classList.toggle('active')});
document.addEventListener('click',()=>document.getElementById('languageDropdown').classList.remove('active'));
document.addEventListener('DOMContentLoaded',()=>{document.getElementById('currentLang').textContent=lang.toUpperCase();updateContent()});
    </script>
</body>
</html>
